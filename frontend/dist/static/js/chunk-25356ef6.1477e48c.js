(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-25356ef6"],{2426:function(e,t,n){},"30b3":function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"i",(function(){return r})),n.d(t,"j",(function(){return l})),n.d(t,"g",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return m}));var i=n("b775");function o(e){return Object(i["a"])({url:"/cmdb/ecs/",method:"get",params:e})}function a(e){return Object(i["a"])({url:"/cmdb/ecs_list/",method:"get",params:e})}function r(e){return Object(i["a"])({url:"/cmdb/ecs/template/",method:"get",params:e,responseType:"blob"})}function l(e){return Object(i["a"])({url:"/cmdb/ecs/"+e+"/unbind/",method:"patch"})}function s(){return Object(i["a"])({url:"/cmdb/ecs/idle/",method:"get"})}function c(e){return Object(i["a"])({url:"/cmdb/ecs/batch_bind/",method:"patch",data:e})}function u(e){return Object(i["a"])({url:"/cmdb/ecs/binds/",method:"patch",data:e})}function d(e){return Object(i["a"])({url:"/cmdb/staff/",method:"get",params:e})}function f(e){return Object(i["a"])({url:"/cmdb/staff/",method:"post",data:e})}function m(e){return Object(i["a"])({url:"/cmdb/staff/"+e+"/",method:"DELETE"})}},"33c5":function(e,t,n){"use strict";var i=n("4796"),o=n.n(i);o.a},3846:function(e,t,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},4796:function(e,t,n){},5118:function(e,t,n){(function(e){var i="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,o=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(o.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new a(o.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n("6017"),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("c8ba"))},6017:function(e,t,n){(function(e,t){(function(e,n){"use strict";if(!e.setImmediate){var i,o=1,a={},r=!1,l=e.document,s=Object.getPrototypeOf&&Object.getPrototypeOf(e);s=s&&s.setTimeout?s:e,"[object process]"==={}.toString.call(e.process)?m():p()?b():e.MessageChannel?g():l&&"onreadystatechange"in l.createElement("script")?h():v(),s.setImmediate=c,s.clearImmediate=u}function c(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return a[o]=r,i(o),o++}function u(e){delete a[e]}function d(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i);break}}function f(e){if(r)setTimeout(f,0,e);else{var t=a[e];if(t){r=!0;try{d(t)}finally{u(e),r=!1}}}}function m(){i=function(e){t.nextTick((function(){f(e)}))}}function p(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function b(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"===typeof n.data&&0===n.data.indexOf(t)&&f(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),i=function(n){e.postMessage(t+n,"*")}}function g(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;f(t)},i=function(t){e.port2.postMessage(t)}}function h(){var e=l.documentElement;i=function(t){var n=l.createElement("script");n.onreadystatechange=function(){f(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function v(){i=function(e){setTimeout(f,0,e)}}})("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,n("c8ba"),n("4362"))},"6b54":function(e,t,n){"use strict";n("3846");var i=n("cb7c"),o=n("0bfb"),a=n("9e1e"),r="toString",l=/./[r],s=function(e){n("2aba")(RegExp.prototype,r,e,!0)};n("79e5")((function(){return"/a/b"!=l.call({source:"a",flags:"b"})}))?s((function(){var e=i(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?o.call(e):void 0)})):l.name!=r&&s((function(){return l.call(this)}))},a85d:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-alert",{attrs:{title:"文件下发功能需要目标主机配置免密登录",type:"info",effect:"light",closable:!1}}),e._v(" "),n("el-dialog",{attrs:{title:"文件上传",visible:e.centerDialogVisible,width:"30%","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.centerDialogVisible=t},close:function(t){return e.resetForm("form")}}},[n("div",{staticClass:"dialog-form"},[n("el-form",{ref:"form",staticClass:"dialogbody",attrs:{model:e.form,rules:e.dialogRules,"label-width":"100px"}},[n("el-upload",{staticClass:"upload-demo",attrs:{"http-request":e.handleFile,multiple:!1,limit:1,drag:"",action:"sss",clearFiles:"","on-exceed":e.handleExceed,"file-list":e.fileList,"before-upload":e.beforeAvatarUpload}},[n("i",{staticClass:"el-icon-upload"}),e._v(" "),n("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或\n            "),n("em",[e._v("点击上传")])]),e._v(" "),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("仅支持 properties|txt|sql|sh|py|xml|yaml|cfg|ini|config|xmind|data|rmi|conf|json|toml 结尾的文件上传，且不超过5MB")])]),e._v(" "),n("div",{staticClass:"upload_form_item"},[n("el-form-item",{attrs:{label:"分发时间",prop:"plan_time"}},[n("el-col",{attrs:{span:17}},[n("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","picker-options":e.pickerOptions,placeholder:"选择日期"},model:{value:e.form.plan_time,callback:function(t){e.$set(e.form,"plan_time",t)},expression:"form.plan_time"}})],1)],1)],1)],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.uploadDoc("form")}}},[e._v("确 定")])],1)]),e._v(" "),n("el-dialog",{attrs:{title:"文件分发",visible:e.DistributeDialogVisible,width:"50%","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.DistributeDialogVisible=t},close:function(t){return e.resetDistribeForm("distributeForm")}}},[n("div",{staticClass:"dialog-form"},[n("el-form",{ref:"distributeForm",attrs:{model:e.distributeForm,rules:e.distributeRules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"文件名",prop:"name"}},[n("el-input",{staticStyle:{width:"91%"},attrs:{type:"text",disabled:""},model:{value:e.distributeForm.name,callback:function(t){e.$set(e.distributeForm,"name",t)},expression:"distributeForm.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"分发实例",prop:"instance"}},[n("el-transfer",{attrs:{filterable:"",titles:["可用实例","已选实例"],"filter-placeholder":"请输入搜索内容",data:e.instanceData},on:{change:e.handleChange},model:{value:e.distributeForm.instance,callback:function(t){e.$set(e.distributeForm,"instance",t)},expression:"distributeForm.instance"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"目标路径",prop:"path"}},[n("el-input",{staticStyle:{width:"91%"},attrs:{placeholder:"请输入"},model:{value:e.distributeForm.path,callback:function(t){e.$set(e.distributeForm,"path",t)},expression:"distributeForm.path"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"文件权限",prop:"permisson"}},[n("el-radio-group",{model:{value:e.distributeForm.permisson,callback:function(t){e.$set(e.distributeForm,"permisson",t)},expression:"distributeForm.permisson"}},[n("el-radio",{attrs:{label:"755"}},[e._v("755")]),e._v(" "),n("el-radio",{attrs:{label:"744"}},[e._v("744")]),e._v(" "),n("el-radio",{attrs:{label:"700"}},[e._v("700")])],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"文件属主",prop:"ownner"}},[n("el-radio-group",{model:{value:e.distributeForm.ownner,callback:function(t){e.$set(e.distributeForm,"ownner",t)},expression:"distributeForm.ownner"}},[n("el-radio",{attrs:{label:"root"}},[e._v("root")]),e._v(" "),n("el-radio",{attrs:{label:"admin"}},[e._v("admin")])],1)],1)],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){return e.resetDistribeForm("distributeForm")}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.distribeFile("distributeForm")}}},[e._v("确 定")])],1)]),e._v(" "),n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[n("el-form-item",{attrs:{label:"文件名"}},[n("el-input",{attrs:{placeholder:"请输入"},model:{value:e.formInline.name,callback:function(t){e.$set(e.formInline,"name",t)},expression:"formInline.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"上传日期"}},[n("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.formInline.plan_time,callback:function(t){e.$set(e.formInline,"plan_time",t)},expression:"formInline.plan_time"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("搜索")])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v("上传文件")])],1)],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{align:"center",label:"ID",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.id)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"文件名",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.name)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"分发状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.status))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.job_status)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"分发时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.plan_time)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"备注",align:"center",width:"140","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.FormatValue(t.row.message))+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"创建时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.create_time)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作者",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.operator)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"参数",align:"center",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.payload)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"created_at",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-bottom",round:""},on:{click:function(n){return e.handleDownload(t.$index,t.row)}}},[e._v("下载")]),e._v(" "),e.distributeFile(t.row)?n("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-share",round:""},on:{click:function(n){return e.handleDistribute(t.$index,t.row)}}},[e._v("分发")]):e.rollbackFile(t.row)?n("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-d-arrow-left",round:""},on:{click:function(n){return e.handleRollback(t.$index,t.row)}}},[e._v("恢复")]):e._e(),e._v(" "),e.deleteFile(t.row)?n("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",round:""},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),e.total>0?n("el-pagination",{staticClass:"pagination",attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e()],1)},o=[],a=(n("28a5"),n("7f7f"),n("b775"));function r(e){return Object(a["a"])({url:"/document/",method:"get",params:e})}function l(e){return Object(a["a"])({url:"/document/",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/document/"+e+"/",method:"delete"})}function c(e){return Object(a["a"])({url:"/document/"+e+"/download/",method:"get"})}function u(e,t){return Object(a["a"])({url:"/document/"+e+"/distribute/",method:"post",data:t})}function d(e,t){return Object(a["a"])({url:"/document/"+e+"/restore/",method:"post",data:t})}n("a481"),n("6b54"),n("7618");function f(e){return e?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():e}function m(e){if("string"===typeof e&&(e=new Date(e)),e){var t=e.getHours(),n=e.getMinutes(),i=e.getSeconds();return t=t<9?"0"+t:t,n=n<9?"0"+n:n,i=i<9?"0"+i:i,e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+t+":"+n+":"+i}return e}function p(e){return e||"-"}var b=n("30b3"),g=n("5118"),h={data:function(){var e=function(e,t,n){if(t.length<1)return n(new Error("实例不能为空"));n()};return{list:null,listLoading:!0,formInline:{name:"",plan_time:""},dialogRules:{plan_time:[{required:!0,trigger:"blur",message:"时间不能为空"}]},form:{plan_time:""},distributeForm:{name:"",instance:[],path:"",permisson:"",ownner:""},distributeRules:{name:[{required:!0,trigger:"blur",message:"文件名不能为空"}],instance:[{required:!0,trigger:"blur",validator:e,type:"array"}],path:[{required:!0,trigger:"blur",message:"路径不能为空"}],permisson:[{required:!0,trigger:"blur",message:"文件权限未选择"}],ownner:[{required:!0,trigger:"blur",message:"文件属主未选择"}]},pickerOptions:{disabledDate:function(e){var t=new Date;return e.getTime()<t.getTime()-864e5}},value:!0,centerDialogVisible:!1,DistributeDialogVisible:!1,fileList:[],instanceData:[],total:0,currentPage:1,pageSize:10,rowId:"",shareFile:["sql","sh","conf","py","properties","xml","yaml","txt"],allowUploadFile:["properties","txt","sql","sh","py","xml","yaml","cfg","ini","config","xmind","data","rmi","conf","json","toml"]}},created:function(){this.fetchData(),this.getInstance()},methods:{getInstance:function(){var e=this;Object(b["f"])().then((function(t){for(var n=t.data,i=0;i<n.length;i++)e.instanceData.push({key:n[i].id,label:n[i].hostname})})).catch((function(e){console.log(e)}))},fetchData:function(){var e=this;this.listLoading=!0,r().then((function(t){e.list=t.data.results,e.total=t.data.count,e.listLoading=!1})).catch((function(e){console.log(e)}))},handleDelete:function(e,t){var n=this;this.$confirm("你真的要删除 "+t.name+" 么？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){s(t.id).then((function(e){for(var i=0;i<n.list.length;i++)n.list[i].id===t.id&&n.list.splice(i,1);n.total-=1,n.$message({type:"success",message:"删除成功!"})})).catch((function(e){console.log(e)}))})).catch((function(){n.$message({type:"info",message:"已取消删除"})}))},beforeAvatarUpload:function(e){var t=-1!==this.allowUploadFile.indexOf(e.name.split(".")[e.name.split(".").length-1]);console.log("allow",t);var n=e.size/1024/1024<5;return t||this.$message.error("上传文件格式不被允许!"),n||this.$message.error("上传文件大小不能超过 5MB!"),t&&n},handleFile:function(e){console.log("fileobj",e),this.fileList.push(e.file)},handleExceed:function(e,t){this.$message.warning("最多上传 ".concat(e.length," 个文件"))},uploadDoc:function(e){var t=this,n=this;n.$refs[e].validate((function(i){if(i){console.log(n.fileList[0]);var o=n.$refs[e].$el,a=new FormData(o);a.append("plan_time",m(t.form.plan_time)),a.append("file",n.fileList[0]),l(a).then((function(e){200===e.status?(n.centerDialogVisible=!1,t.$message.success("文件上传成功"),n.fileList=[],Object(g["setTimeout"])((function(){t.fetchData()}),2e3)):t.$message.error("文件上传失败")})).catch((function(e){console.log(e)}))}else console.log("error")}))},resetForm:function(e){this.$refs[e].resetFields(),this.fileList=[],this.centerDialogVisible=!1},onSearch:function(){var e=this;r({name:this.formInline.name,create_time:f(this.formInline.plan_time)}).then((function(t){e.list=t.data.results,e.total=t.data.count})).catch((function(e){console.log(e)}))},handleSizeChange:function(e){this.pageSize=e,this.findPage(this.currentPage,this.pageSize)},handleCurrentChange:function(e){this.currentPage=e,this.findPage(this.currentPage,this.pageSize)},findPage:function(e,t){var n=this;r({page:e,page_size:t}).then((function(e){n.list=e.data.results,n.total=e.data.count})).catch((function(e){console.log(e)}))},checkStatus:function(e){return 0===e?"已上传待确认":"已确认"},FormatValue:p,distributeFile:function(e){return"未设置"===e.status&&-1!==this.shareFile.indexOf(e.name.split(".")[e.name.split(".").length-1])||"已执行"===e.status&&"失败"===e.job_status},rollbackFile:function(e){return"成功"==e.job_status&&!e.message},deleteFile:function(e){return"未设置"===e.status&&"未执行"===e.job_status||"已执行"===e.status&&"失败"===e.job_status},handleDownload:function(e,t){c(t.id).then((function(e){var n=new Blob([e.data]);if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(n,t.name);else{var i=document.createElement("a"),o=document.createEvent("HTMLEvents");o.initEvent("click",!1,!1),i.href=URL.createObjectURL(n),i.download=t.name,i.style.display="none",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(i.href)}})).catch((function(e){console.log(e.response)}))},handleDistribute:function(e,t){this.DistributeDialogVisible=!0,this.distributeForm.name=t.name,this.rowId=t.id},handleRollback:function(e,t){var n=this;this.$confirm("你真的要恢复 "+t.name+" 么？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d(t.id).then((function(e){n.$message({type:"success",message:"操作成功!"}),n.fetchData()})).catch((function(e){console.log(e)}))})).catch((function(){}))},handleChange:function(e,t,n){console.log(e,t,n)},distribeFile:function(e){var t=this;this.$refs[e].validate((function(e){if(e){console.log("valid");var n="",i=t.distributeForm.ownner;n="root"===i?{commands:{permission:t.distributeForm.permisson},path:t.distributeForm.path,servers:t.distributeForm.instance}:{commands:{owner:!0,group:1,permission:t.distributeForm.permisson},path:t.distributeForm.path,servers:t.distributeForm.instance},u(t.rowId,{payload:n}).then((function(e){200===e.status?(t.DistributeDialogVisible=!1,t.$message.success("分发文件配置成功"),Object(g["setTimeout"])((function(){t.fetchData()}),2e3)):t.$message.error("分发配置失败")})).catch((function(e){console.log(e)}))}else console.log("error")}))},resetDistribeForm:function(e){this.DistributeDialogVisible=!1,this.$refs[e].resetFields()}}},v=h,_=(n("33c5"),n("ae3f"),n("2877")),y=Object(_["a"])(v,i,o,!1,null,"ec539c0e",null);t["default"]=y.exports},ae3f:function(e,t,n){"use strict";var i=n("2426"),o=n.n(i);o.a}}]);